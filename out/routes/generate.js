// Generated by IcedCoffeeScript 1.8.0-a
(function() {
  var sessionBridge;

  sessionBridge = require('../utils/sessionBridge');

  module.exports = function(req, res) {
    var config, docpad, session, time;
    config = this.config;
    docpad = this.docpad;
    session = sessionBridge.get(req);
    if (!session.authenticated) {
      res.redirect('/' + config.prefix.url + '/login?url=' + req.url);
      return;
    }
    time = new Date().getTime();
    return docpad.action('generate', {
      reset: true
    }, function(err) {
      var _ref;
      if (err) {
        (process.stderr.write((_ref = err.message) != null ? _ref : err) + '').trim() + "\n";
      }
      res.set('Content-Type', 'application/json; charset=UTF-8');
      return res.send(JSON.stringify({
        result: new Date().getTime() - time
      }));
    });
  };

}).call(this);
