// Generated by IcedCoffeeScript 1.8.0-a
(function() {
  module.exports = function() {
    if (this.shouldLoadScript) {
      coffeescript(function() {
        return window.minicms_component_markdown = function(prefix, form, name) {
          var editor, field;
          field = $('#field-' + form + '-' + name);
          console.log(name + " = " + $('#' + form + '-form').data('fields')[name]);
          field.data('value', $('#' + form + '-form').data('fields')[name]);
          editor = field.data('epiceditor');
          if (editor == null) {
            field.data('epiceditor', true);
            return $(document).ready(function() {
              var defaultVal;
              defaultVal = field.data('value');
              if (typeof defaultVal !== 'string') {
                defaultVal = '';
              }
              return setTimeout((function() {
                editor = new EpicEditor({
                  container: 'form-input-' + form + '-' + name + '--epiceditor',
                  basePath: '/' + prefix + '/vendor/epiceditor',
                  clientSideStorage: false,
                  file: {
                    defaultContent: defaultVal
                  },
                  button: {
                    preview: true,
                    fullscreen: false
                  },
                  theme: {
                    base: '/themes/base/epiceditor.css',
                    preview: '/../../css/epic-preview-minicms.css',
                    editor: '/../../css/epic-editor-minicms.css'
                  }
                });
                field.data('epiceditor', editor);
                editor.load(function() {
                  return $(this.getElement('editor').body).bind('paste', function() {
                    return setTimeout((function() {
                      return editor.sanitize();
                    }), 1);
                  });
                });
                $('#form-input-' + form + '-' + name + '--epiceditor iframe').css('visibility', 'hidden');
                setTimeout((function() {
                  $('#form-input-' + form + '-' + name + '--epiceditor iframe').css('visibility', 'visible');
                  return minicms_form_load(prefix, form, name);
                }), 250);
                return editor.on('update', function() {
                  var text;
                  text = editor.exportFile();
                  console.log(name + " = " + text);
                  field.data('value', text);
                  return minicms_form_update(prefix, form);
                });
              }), 100);
            });
          }
        };
      });
    }
    div('#field-' + this.form + '-' + this.field + '.control-group.form-component-markdown', function() {
      return div('.form-field-content', function() {
        label('.control-label', {
          "for": "form-input-" + this.form + "-" + this.field
        }, function() {
          return h(this.label);
        });
        return div('.controls', function() {
          return div('#form-input-' + this.form + '-' + this.field + '--epiceditor.input-xlarge.fake-field', {
            style: "width:600px;height:" + (this.height ? this.height : 320) + "px"
          }, function() {});
        });
      });
    });
    return text('<script type="text/javascript">minicms_component_markdown("' + this.config.prefix.url + '", "' + this.form + '", "' + this.field + '");</script>');
  };

}).call(this);
