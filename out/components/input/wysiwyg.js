// Generated by IcedCoffeeScript 1.8.0-a
(function() {
  module.exports = function() {
    if (this.shouldLoadScript) {
      coffeescript(function() {
        return window.minicms_component_wysiwyg = function(prefix, form, name) {
          var editor, field;
          field = $('#field-' + form + '-' + name);
          console.log(name + " = " + $('#' + form + '-form').data('fields')[name]);
          field.data('value', $('#' + form + '-form').data('fields')[name]);
          editor = null;
          $(document).ready(function() {
            return setTimeout((function() {
              $('#form-input-' + form + '-' + name).wysihtml5('deepExtend', {
                'font-styles': true,
                'emphasis': true,
                'lists': true,
                'html': true,
                'link': true,
                'image': true,
                'color': false,
                events: {
                  change: function() {
                    console.log(name + " = " + $('#form-input-' + form + '-' + name).val());
                    field.data('value', $('#form-input-' + form + '-' + name).val());
                    return minicms_form_update(prefix, form);
                  }
                },
                stylesheets: [],
                parserRules: {
                  tags: {
                    iframe: {
                      check_attributes: {
                        src: 'url',
                        width: 'numbers',
                        height: 'numbers'
                      },
                      set_attributes: {
                        frameborder: '0',
                        seamless: 'seamless'
                      }
                    }
                  }
                }
              });
              return minicms_form_load(prefix, form, name);
            }), 1);
          });
          return $('textarea.form-value', field).on('change', function() {
            if ($(this).val() !== field.data('value')) {
              console.log(name + " = " + $(this).val());
              field.data('value', $(this).val());
              return minicms_form_update(prefix, form);
            }
          });
        };
      });
    }
    div('#field-' + this.form + '-' + this.field + '.control-group.form-component-wysiwyg', function() {
      return div('.form-field-content', function() {
        label('.control-label', {
          "for": "form-input-" + this.form + "-" + this.field
        }, function() {
          return h(this.label);
        });
        return div('.controls', function() {
          return textarea('#form-input-' + this.form + '-' + this.field + '.form-value.input-xlarge.no-halo', {
            style: "width:600px;height:" + (this.height ? this.height : 320) + "px",
            name: this.field
          }, function() {
            return h(this.value != null ? this.value : '');
          });
        });
      });
    });
    return text('<script type="text/javascript">minicms_component_wysiwyg("' + this.config.prefix.url + '", "' + this.form + '", "' + this.field + '");</script>');
  };

}).call(this);
